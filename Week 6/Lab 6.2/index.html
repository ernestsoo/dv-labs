<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta name="description" content="Data Visualisation Exercise 6" />
    <meta name="keywords"    content="HTML, CSS, D3"/>
    <meta name="author"      content="Ernest Soo"/>

    <title>Task 6.2 D3 Interactivity - Sort</title>


    <script src="https://d3js.org/d3.v4.min.js"></script>

    <link rel="stylesheet" type="text/css" href="index.css">
      

  </head>


  <body>

    <h1>Bar Chart with Mouse Over and Sort</h1>

    <div>
        <div class="btn btn-add" >
          Add
        </div>

        <div class="btn btn-remove" >
          Remove
        </div>
        
        <div class="btn btn-sort" >
          Sort
        </div>
    </div>
      
    <script>

      var w = 500;
      var h = 150;

      // Initalize Padding between bars
      var barPadding = 2;

      var scaleFactor = 4;

      // Initialize Datasets
      var dataset = [15, 5, 29, 23,19,21,3,10,33,45];
 

      var xScale = d3.scaleBand()
                     .domain(d3.range(dataset.length))
                     .rangeRound([0,w])
                     .paddingInner(0.05);
        
    
      var yScale = d3.scaleLinear()
                     .domain([0,d3.max(dataset)])
                     .range([0,h]);

      var svg = d3.select("body")
                  .append("svg")
                  .attr("width",w)
                  .attr("height",h);


      svg.selectAll("rect")
          .data(dataset)
          .enter()
          .append("rect")
          .attr("x", function(d,i){
            return xScale(i);
          })
          .attr("y", function(d,i){
            return h - yScale(d);
          })
          .attr("width", xScale.bandwidth())
          .attr("height", function(d){
            return yScale(d);
          })
          .attr("fill","blue")
          .on("mouseover", function(d){
                d3.select(this)
                    .attr("fill","orange");
          
                var xPosition = parseFloat(d3.select(this).attr("x"));
                var yPosition = parseFloat(d3.select(this).attr("y"));
          
          
                svg.append("text")
                    .attr("id","tooltip")
                    .attr("x",xPosition+16)
                    .attr("y",yPosition+16)
                    .text(d);
          })
          .on("mouseout",function(d){
          
                d3.select(this)
                    .attr("fill","blue");
          
                d3.select("#tooltip").remove();
          
          });
        
        
        
        function addData()
        {
            var maxValue = 25;
            var numValues = dataset.length;
            
       
            
            // Generate one new data
            dataset.push(Math.floor(Math.random() * maxValue));
            
            // Update xScale
            xScale.domain(d3.range(dataset.length));
            
            
            // Update new domain with d3.max()
            yScale = d3.scaleLinear()
                     .domain([0,d3.max(dataset)])
                     .range([0,h]);
            
        }
        
        var sortOrder = false;
        
        function sortBars()
        {
            sortOrder = !sortOrder;
            
            svg.selectAll("rect")
                .sort(function(a,b){
                    if(sortOrder)
                    {
                        return d3.ascending(a,b); 
                    }else{
                        return d3.descending(a,b);
                    }
                })
                .transition()
                .attr("x", function(d,i){
                    return xScale(i);
                });
        }
        
        
        d3.select(".btn-add")
            .on("click", function(){
            
    
            addData();
            
       
            var bars = svg.selectAll("rect")
                            .data(dataset);
            
            bars.enter()
                .append("rect")
                .attr("x",w)
                .attr("y", function(d){
                    return h - yScale(d);
                })
               .on("mouseover", function(d){
                d3.select(this)
                    .attr("fill","orange");
          
                var xPosition = parseFloat(d3.select(this).attr("x"));
                var yPosition = parseFloat(d3.select(this).attr("y"));
          
          
                svg.append("text")
                    .attr("id","tooltip")
                    .attr("x",xPosition+15)
                    .attr("y",yPosition+16)
                    .text(d);
                })
                .on("mouseout",function(d){
                    d3.select(this)
                        .attr("fill","blue");

                    d3.select("#tooltip").remove();
                })
                .merge(bars)
                .transition()
                .duration(500)
                .attr("x", function(d,i){
                    return xScale(i);
                })
                .attr("y", function(d,i){
                    return h - yScale(d);
                })
                .attr("width", xScale.bandwidth())
                .attr("height", function(d){
                    return yScale(d);
                  })
                .attr("fill","blue");
               
        });
        
        d3.select(".btn-remove")
            .on("click",function(){
            
            alert("remove");
            dataset.shift();
            
            var bars = svg.selectAll("rect")
                        .data(dataset);
            
            bars.exit()
                .transition()
                .duration(500)
                .attr("x", w)
                .remove();
        });
        
        d3.select(".btn-sort")
            .on("click", function(){
                sortBars();
            });
        

    </script>

    <br>
    <bf>

    <footer style="color:grey">COS30045 Data Visualisation<br> Joe Bloggs</footer>

  </body>





</html>
